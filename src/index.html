<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>TRM Charts</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <!-- stylesheets sources -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/trm.css">
    <link href="css/c3.css" media="screen" rel="stylesheet" type="text/css">

    <!-- javascript sources -->
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    <script type="application/javascript" src="js/d3-3.5.6.min.js"></script>
    <script type="application/javascript" src="js/c3.min.js"></script>
    <script type="application/javascript" src="js/trm.js"></script>

</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<!-- Add your site or application content here -->
<div class="title">Relative Theory of Money Charts</div>

<form>
    <div class="frame">
        <div class="row">
            <label for="life_expectancy">Life Expectancy</label>
            <input id="life_expectancy" type="text" name="life_expectancy"
                   title="Members life expectancy in Years"/>
            <span>Years</span>
        </div>
        <div class="row">
            <label for="growth">Growth</label>
            <input id="growth" type="text" name="growth" disabled="disabled"
                    title="Monetary mass growth in percent per year based on members life expectancy (ev) : ln(ev/2)/(ev/2) * 100"/>
            <span>% / Year</span>
        </div>
        <div class="row">
            <label for="dividend_start">First Dividend</label>
            <input id="dividend_start" type="text" name="dividend_start"
            title="Firt dividend value in units"/>
            <span>Units</span>
        </div>
        <div class="row">
            <label for="money_duration">Money Duration</label>
            <input id="money_duration" type="text" name="money_duration" title="Duration of the money in years (chart X axis size)"/>
            <span>Years</span>
        </div>
        <input id="generate_button" type="button" value="Update" name="generate_button">
    </div>
    <div class="frame">
        <label for="new_account_birth">New member birth year</label><input id="new_account_birth" type="text"
                                                                           title="Set the year of birth of the next new member"/>
        <input id="add_account" type="button" value="New Member"/>
        <input id="delete_last_account" type="button" value="Delete Last Member"/>
    </div>
    <div class="frame">
        <label for="reference_frame">Reference Frame</label><select id="reference_frame" name="money_duration"></select>
    </div>

</form>

<div id="chart" class="frame"></div>

<script type="application/javascript">

    /**
     * GUI Form class
     */
    gui_form_class = function () {

        this.life_expectancy = 80;
        this.dividend_start = 1000;
        this.money_duration = 160;
        this.reference_frame = 'quantitative_uda';
        this.new_account_birth = 1;

        // Fill the form
        this.init = function () {
            document.getElementById('life_expectancy').value = this.life_expectancy;
            document.getElementById('dividend_start').value = this.dividend_start;
            document.getElementById('money_duration').value = this.money_duration;
            document.getElementById('new_account_birth').value = this.new_account_birth;
        };

        // Capture user entry
        this.get_data = function () {
            this.life_expectancy = parseInt(document.getElementById('life_expectancy').value);
            this.dividend_start = parseInt(document.getElementById('dividend_start').value);
            this.money_duration = parseInt(document.getElementById('money_duration').value);
            this.new_account_birth = parseInt(document.getElementById('new_account_birth').value);
            this.reference_frame = document.getElementById('reference_frame').options[
                document.getElementById('reference_frame').selectedIndex
                ].value;
        };

        // Create reference frame selector
        this.set_reference_frames = function (reference_frames) {
            document.getElementById('reference_frame').options = [];
            for (var index in Object.getOwnPropertyNames(reference_frames)) {
                var key = Object.getOwnPropertyNames(reference_frames)[index];
                document.getElementById('reference_frame').add(
                    new Option(reference_frames[key].name, key)
                );
            }
        };

        // Update dynamic values in form
        this.update = function () {
            // calculated growth
            document.getElementById('growth').value = (money.growth * 100).toFixed(2);
        }
    };

    // create instance form handler
    var money_form = {};
    gui_form_class.call(money_form);

    // fill form with preset data
    money_form.init();

    // Create instance context
    var money = {};
    // Create instance of class in context with constructor parameters
    libre_money_class.call(money, money_form.life_expectancy, money_form.dividend_start, money_form.money_duration);

    // capture reference_frames list
    money_form.set_reference_frames(money.reference_frames);

    // add a member account
    money.add_account('Member 1', 1);

    // generate data
    var data = money.get_data();

    // update dynamic values in form
    money_form.update();

    // create and display chart from data
    chart = c3.generate({
        bindto: '#chart',
        axis: {
            x: {
                label: 'Year'
            },
            y: {
                label: money.reference_frames[money.reference_frame].unit_label
            }
        },
        tooltip: {
            format: {
                value: function (value, ratio, id, index) {
                    if (id == 'people') {
                        return value;
                    }
                    var f = d3.format('.2f');
                    return f(value);
                }
            }
        },
        data: data
    });

    /**
     * Update chart data
     */
    function update() {

        // capture form values
        money_form.get_data();

        // update money values
        money.life_expectancy = money_form.life_expectancy;
        money.dividend_start = money_form.dividend_start;
        money.money_duration = money_form.money_duration;
        money.reference_frame = money_form.reference_frame;

        // Axes
        chart.axis.labels({
            y: money.reference_frames[money.reference_frame].unit_label
        });

        // calculate data
        var data = money.get_data();

        // update dynamic values in form
        money_form.update();

        // tell load command to unload old data
        data.unload = true;

        // reload data in chart
        chart.load(data);
    }

    /**
     * Delete last account
     */
    function delete_last_account() {
        var account = money.delete_last_account();
        // If account deleted...
        if (account != false) {
            // Update remaining data
            update();
        }
    }

    /**
     * Add account
     */
    function add_account() {
        // construct name
        var name = 'Member ' + (money.accounts.length + 1)

        // capture user entry
        money_form.get_data();

        // add a member account at the birth date specified
        money.add_account(name, parseInt(money_form.new_account_birth));

        update();
    }

    document.getElementById('generate_button').addEventListener('click', update);
    document.getElementById('reference_frame').addEventListener('change', update);

    document.getElementById('add_account').addEventListener('click', add_account);
    document.getElementById('delete_last_account').addEventListener('click', delete_last_account);

</script>

<!--
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
-->
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID.
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='https://www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>-->
</body>
</html>
